"use strict";(globalThis.webpackChunkphysical_ai_robotics_textbook=globalThis.webpackChunkphysical_ai_robotics_textbook||[]).push([[183],{8453(e,n,t){t.d(n,{R:()=>o,x:()=>a});var s=t(6540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},9624(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"AUTH_SYSTEM_DESIGN","title":"Authentication & Personalization System Design","description":"Technology Stack: Docusaurus (Frontend), Better-Auth (Auth Engine), Neon Serverless Postgres (Database), Node.js/Hono (Backend API).","source":"@site/docs/AUTH_SYSTEM_DESIGN.md","sourceDirName":".","slug":"/AUTH_SYSTEM_DESIGN","permalink":"/docs/AUTH_SYSTEM_DESIGN","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/AUTH_SYSTEM_DESIGN.md","tags":[],"version":"current","frontMatter":{}}');var i=t(4848),r=t(8453);const o={},a="Authentication & Personalization System Design",l={},d=[{value:"1. Executive Summary",id:"1-executive-summary",level:2},{value:"2. System Architecture",id:"2-system-architecture",level:2},{value:"3. Database Schema (Neon Postgres)",id:"3-database-schema-neon-postgres",level:2},{value:"3.1 Core Auth Tables (Better-Auth Standard)",id:"31-core-auth-tables-better-auth-standard",level:3},{value:"3.2 User Profile &amp; Hardware Context",id:"32-user-profile--hardware-context",level:3},{value:"4. API Design (Backend)",id:"4-api-design-backend",level:2},{value:"4.1 Auth Routes (Automated by Better-Auth)",id:"41-auth-routes-automated-by-better-auth",level:3},{value:"4.2 Profile Routes (Custom)",id:"42-profile-routes-custom",level:3},{value:"5. Frontend Integration (Docusaurus)",id:"5-frontend-integration-docusaurus",level:2},{value:"5.1 Installation",id:"51-installation",level:3},{value:"5.2 Auth Client Setup",id:"52-auth-client-setup",level:3},{value:"5.3 Onboarding Wizard Component",id:"53-onboarding-wizard-component",level:3},{value:"5.4 Personalization Context",id:"54-personalization-context",level:3},{value:"5.5 Adaptive Content Component",id:"55-adaptive-content-component",level:3},{value:"6. Security Considerations",id:"6-security-considerations",level:2},{value:"7. Integration with Personalization Agent",id:"7-integration-with-personalization-agent",level:2}];function c(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"authentication--personalization-system-design",children:"Authentication & Personalization System Design"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Technology Stack"}),": Docusaurus (Frontend), Better-Auth (Auth Engine), Neon Serverless Postgres (Database), Node.js/Hono (Backend API)."]}),"\n",(0,i.jsx)(n.h2,{id:"1-executive-summary",children:"1. Executive Summary"}),"\n",(0,i.jsx)(n.p,{children:'This specification outlines the architecture for adding a robust Signup/Signin system to the "Physical AI & Humanoid Robotics" textbook platform. The goal is to move from a static content viewer to an intelligent, personalized learning platform that adapts content based on the user\'s hardware (e.g., "Do you have an NVIDIA GPU?") and expertise level.'}),"\n",(0,i.jsxs)(n.p,{children:["We will use ",(0,i.jsx)(n.strong,{children:"Better-Auth"})," for its modern, secure, and extensible authentication capabilities, backed by ",(0,i.jsx)(n.strong,{children:"Neon Postgres"})," for serverless scalability."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-system-architecture",children:"2. System Architecture"}),"\n",(0,i.jsx)(n.p,{children:"Since Docusaurus is a static-site generator (SSG) / Single Page Application (SPA) hybrid, it cannot host the server-side logic required for secure authentication and database interactions."}),"\n",(0,i.jsxs)(n.p,{children:["We propose a ",(0,i.jsx)(n.strong,{children:"Headless Auth Architecture"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Frontend (The Textbook)"}),": Docusaurus (React) running on the client."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Backend (The Brain)"}),": A lightweight Node.js API Service (using Hono or Express) hosted on Vercel/Render/Railway."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Database"}),": Neon Serverless Postgres."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mermaid",children:'graph TD\n    User[User Browser]\n    Frontend[Docusaurus App]\n    AuthAPI[Auth Server (Node.js + Better-Auth)]\n    DB[(Neon Postgres)]\n    Agent[Personalization Agent]\n\n    User --\x3e Frontend\n    Frontend -- "1. Login/Signup (Client Client)" --\x3e AuthAPI\n    AuthAPI -- "2. Verify/Store" --\x3e DB\n    Frontend -- "3. Get Profile" --\x3e AuthAPI\n    AuthAPI -- "4. Fetch Data" --\x3e DB\n    Frontend -- "5. Render Adaptive Content" --\x3e User\n    Agent -- "6. Analyze Progress" --\x3e DB\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"3-database-schema-neon-postgres",children:"3. Database Schema (Neon Postgres)"}),"\n",(0,i.jsxs)(n.p,{children:["We will use a relational schema. Better-Auth requires core tables (",(0,i.jsx)(n.code,{children:"user"}),", ",(0,i.jsx)(n.code,{children:"session"}),", ",(0,i.jsx)(n.code,{children:"account"}),", ",(0,i.jsx)(n.code,{children:"verification"}),"). We will extend this with a ",(0,i.jsx)(n.code,{children:"profile"})," table."]}),"\n",(0,i.jsx)(n.h3,{id:"31-core-auth-tables-better-auth-standard",children:"3.1 Core Auth Tables (Better-Auth Standard)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE "user" (\n    "id" TEXT NOT NULL PRIMARY KEY,\n    "name" TEXT NOT NULL,\n    "email" TEXT NOT NULL UNIQUE,\n    "emailVerified" BOOLEAN NOT NULL,\n    "image" TEXT,\n    "createdAt" TIMESTAMP NOT NULL,\n    "updatedAt" TIMESTAMP NOT NULL\n);\n\nCREATE TABLE "session" (\n    "id" TEXT NOT NULL PRIMARY KEY,\n    "expiresAt" TIMESTAMP NOT NULL,\n    "ipAddress" TEXT,\n    "userAgent" TEXT,\n    "userId" TEXT NOT NULL REFERENCES "user"("id")\n);\n\nCREATE TABLE "account" (\n    "id" TEXT NOT NULL PRIMARY KEY,\n    "accountId" TEXT NOT NULL,\n    "providerId" TEXT NOT NULL,\n    "userId" TEXT NOT NULL REFERENCES "user"("id"),\n    "accessToken" TEXT,\n    "refreshToken" TEXT,\n    "idToken" TEXT,\n    "expiresAt" TIMESTAMP,\n    "password" TEXT -- If using credential auth\n);\n\nCREATE TABLE "verification" (\n    "id" TEXT NOT NULL PRIMARY KEY,\n    "identifier" TEXT NOT NULL,\n    "value" TEXT NOT NULL,\n    "expiresAt" TIMESTAMP NOT NULL\n);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"32-user-profile--hardware-context",children:"3.2 User Profile & Hardware Context"}),"\n",(0,i.jsx)(n.p,{children:'This table stores the "Context" needed for the Personalization Agent.'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE TABLE "user_profile" (\n    "userId" TEXT NOT NULL PRIMARY KEY REFERENCES "user"("id"),\n    \n    -- Expertise Level\n    "role" TEXT NOT NULL DEFAULT \'student\', -- student, instructor, researcher\n    "expertiseLevel" TEXT NOT NULL DEFAULT \'beginner\', -- beginner, intermediate, advanced\n    \n    -- Hardware Context (Crucial for Robotics)\n    "hasNvidiaGpu" BOOLEAN DEFAULT FALSE,\n    "gpuModel" TEXT, -- e.g., "RTX 3060", "Orin Nano"\n    "osType" TEXT, -- "windows", "linux", "mac"\n    "hasRealRobot" BOOLEAN DEFAULT FALSE,\n    "robotType" TEXT, -- e.g., "Unitree Go2", "Franka Emika"\n    \n    -- Learning Goals\n    "interests" TEXT[], -- ["ros2", "sim2real", "vla"]\n    \n    "createdAt" TIMESTAMP DEFAULT NOW(),\n    "updatedAt" TIMESTAMP DEFAULT NOW()\n);\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"4-api-design-backend",children:"4. API Design (Backend)"}),"\n",(0,i.jsx)(n.p,{children:"The backend service will expose the Better-Auth routes and custom profile endpoints."}),"\n",(0,i.jsx)(n.h3,{id:"41-auth-routes-automated-by-better-auth",children:"4.1 Auth Routes (Automated by Better-Auth)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"POST /api/auth/sign-up"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"POST /api/auth/sign-in"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"POST /api/auth/sign-out"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"GET /api/auth/session"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"42-profile-routes-custom",children:"4.2 Profile Routes (Custom)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"POST /api/onboarding"}),"\n",(0,i.jsx)(n.em,{children:"Triggered after initial signup to collect hardware details."})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "expertiseLevel": "intermediate",\n  "hasNvidiaGpu": true,\n  "gpuModel": "RTX 4090",\n  "osType": "linux"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"GET /api/agent/recommendations"}),"\n",(0,i.jsx)(n.em,{children:"Used by the frontend to fetch personalization hints."}),"\n",(0,i.jsx)(n.em,{children:"Response:"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "showAdvancedPhysics": true,\n  "suggestedModule": "module-3-ai-robot-brain",\n  "hardwareWarning": null\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"5-frontend-integration-docusaurus",children:"5. Frontend Integration (Docusaurus)"}),"\n",(0,i.jsx)(n.h3,{id:"51-installation",children:"5.1 Installation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install better-auth @better-auth/react axios\n"})}),"\n",(0,i.jsx)(n.h3,{id:"52-auth-client-setup",children:"5.2 Auth Client Setup"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"src/lib/auth-client.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'import { createAuthClient } from "better-auth/react";\n\nexport const authClient = createAuthClient({\n    baseURL: "https://your-auth-api.com" // Point to your backend\n});\n'})}),"\n",(0,i.jsx)(n.h3,{id:"53-onboarding-wizard-component",children:"5.3 Onboarding Wizard Component"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"src/components/OnboardingWizard.js"}),". This is a modal that appears if ",(0,i.jsx)(n.code,{children:"user.profile"})," is missing."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import React, { useState } from 'react';\nimport { authClient } from '../lib/auth-client';\n\nexport const OnboardingWizard = ({ onComplete }) => {\n  const [formData, setFormData] = useState({\n    level: 'beginner',\n    gpu: false,\n    os: 'windows'\n  });\n\n  const handleSubmit = async () => {\n    // Call API to save profile\n    await fetch('https://your-api.com/api/onboarding', {\n      method: 'POST',\n      body: JSON.stringify(formData)\n    });\n    onComplete();\n  };\n\n  return (\n    <div className=\"modal\">\n      <h2>Welcome! Let's customize your textbook.</h2>\n      \n      <label>What is your ROS 2 experience?</label>\n      <select onChange={e => setFormData({...formData, level: e.target.value})}>\n        <option value=\"beginner\">Beginner (What is a Node?)</option>\n        <option value=\"intermediate\">Intermediate (I use rclpy)</option>\n        <option value=\"advanced\">Advanced (I write middleware)</option>\n      </select>\n\n      <label>\n        <input type=\"checkbox\" onChange={e => setFormData({...formData, gpu: e.target.checked})} />\n        Do you have an NVIDIA GPU?\n      </label>\n\n      <button onClick={handleSubmit}>Start Learning</button>\n    </div>\n  );\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"54-personalization-context",children:"5.4 Personalization Context"}),"\n",(0,i.jsxs)(n.p,{children:["Wrap the app in ",(0,i.jsx)(n.code,{children:"src/theme/Root.js"})," with an ",(0,i.jsx)(n.code,{children:"AuthProvider"})," that fetches the session and profile."]}),"\n",(0,i.jsx)(n.h3,{id:"55-adaptive-content-component",children:"5.5 Adaptive Content Component"}),"\n",(0,i.jsx)(n.p,{children:"A component to show/hide content based on the profile."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// src/components/AdaptiveBlock.js\nimport { useAuth } from '../hooks/useAuth'; // Custom hook\n\nexport const AdaptiveBlock = ({ level, requiresGpu, children }) => {\n  const { user, profile } = useAuth();\n\n  if (requiresGpu && !profile.hasNvidiaGpu) {\n    return <div className=\"warning\">Note: This section requires an NVIDIA GPU. You can skip or run in Cloud.</div>;\n  }\n\n  // If user is beginner, hide advanced blocks unless they toggle \"Show All\"\n  if (level === 'advanced' && profile.expertiseLevel === 'beginner') {\n    return <details><summary>Advanced Topic (Click to expand)</summary>{children}</details>;\n  }\n\n  return <div>{children}</div>;\n};\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"6-security-considerations",children:"6. Security Considerations"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"HttpOnly Cookies"}),": Better-Auth uses HttpOnly cookies by default for session management. This prevents XSS attacks from stealing tokens."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"CORS"}),": The backend API must be configured to allow CORS ",(0,i.jsx)(n.em,{children:"only"})," from the Docusaurus domain."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Role-Based Access Control (RBAC)"}),": The API should verify ",(0,i.jsx)(n.code,{children:"user.role"})," before allowing administrative actions (like editing content, if implemented)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data Minimization"}),": Only store hardware specs relevant to the curriculum. Do not collect PII beyond email/name."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"7-integration-with-personalization-agent",children:"7. Integration with Personalization Agent"}),"\n",(0,i.jsxs)(n.p,{children:['The "Personalization Agent" is effectively an AI service that reads the ',(0,i.jsx)(n.code,{children:"user_profile"})," and ",(0,i.jsx)(n.code,{children:"user_progress"})," (future) to recommend the next best module."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Integration Pattern:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Direct DB Access"}),": The AI Agent (running as a cron job or microservice) has read-only access to the ",(0,i.jsx)(n.code,{children:"user_profile"})," table."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Webhook"}),": When a user completes a quiz (in the textbook), a webhook ",(0,i.jsx)(n.code,{children:"POST /api/progress"})," is sent. The Agent analyzes this and updates a ",(0,i.jsx)(n.code,{children:"recommended_path"})," field in the DB."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"UI Feedback"}),": The Docusaurus frontend queries ",(0,i.jsx)(n.code,{children:"recommended_path"})," and highlights the next chapter in the sidebar."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);